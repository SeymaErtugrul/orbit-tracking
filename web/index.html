<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Çoklu Uydu Takibi (Three.js)</title>
    <style>
        body { margin: 0; overflow: hidden; } 
        canvas { display: block; }
        
        /* Arayüz Stili */
        #satellite-menu {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            color: white;
            font-family: Arial, sans-serif;
            z-index: 100;
        }
        .sat-button {
            display: block;
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            background-color: #333;
            color: white;
            border: 1px solid #555;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .sat-button:hover {
            background-color: #007bff;
        }
    </style>
</head>
<body>
    <div id="satellite-menu">
        <h3>Uydu Seçim Menüsü</h3>
        </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // --- Global Değişkenler ---
        let scene, camera, renderer, controls;
        let earth, satellite;
        let allOrbitData = {}; // Tüm uyduların verilerini tutacak obje
        let orbitData = [];     // Şu anda seçili olan uydunun verisi
        let currentDataIndex = 0;
        const EARTH_RADIUS_KM = 6371;
        const ORBIT_ANIMATION_SPEED = 0.05; // Gerçek zamanlıya yakın hız (1/60 veya 1/30 deneyin)
        let lastUpdateTime = performance.now();

        // --- İnisiyalizasyon ---
        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050505);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            
            // Kamera (Uzayı görebilmek için uzak konumlandırma)
            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 500000);
            camera.position.set(30000, 30000, 30000);
            camera.lookAt(new THREE.Vector3(0, 0, 0));

            // Işıklandırma
            const sunLight = new THREE.DirectionalLight(0xffffff, 3.5);
            sunLight.position.set(50000, 50000, 50000); 
            scene.add(sunLight);
            scene.add(new THREE.AmbientLight(0x444444, 1)); 
// --- Sade Gerçekçi Dünya ---
const earthGeometry = new THREE.SphereGeometry(EARTH_RADIUS_KM, 64, 64);
const textureLoader = new THREE.TextureLoader();

// Gündüz haritası (renkli)
const dayMap = textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg');

const earthMaterial = new THREE.MeshPhongMaterial({
    map: dayMap,      // Texture ekledik
    shininess: 10     // Hafif parlaklık
});

earth = new THREE.Mesh(earthGeometry, earthMaterial);
scene.add(earth);

            // Uydu Modeli (Kırmızı küre)
            const satSize = 100;
            const satGeometry = new THREE.SphereGeometry(satSize, 16, 16);
            const satMaterial = new THREE.MeshBasicMaterial({ color: 0xff3300 });
            satellite = new THREE.Mesh(satGeometry, satMaterial);
            scene.add(satellite); 

            // Kontroller
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.minDistance = EARTH_RADIUS_KM * 1.5; 
            controls.maxDistance = EARTH_RADIUS_KM * 50;

            window.addEventListener('resize', onWindowResize);

            loadOrbitData();
        }

        // --- Veri ve Menü Fonksiyonları ---

      function loadOrbitData() {
    fetch('all_orbit_data.json') 
        // ... (response kontrolü)
        .then(response => response.json()) // JSON formatına çevrilir
        .then(data => {
            console.log("JSON Yüklendi. Nesne Kontrolü:", data);
            
            // Veri nesnesindeki anahtarları (Uydu İsimlerini) kontrol et.
            const satelliteNames = Object.keys(data);
            console.log("Bulunan Uydu İsimleri:", satelliteNames); 

            // Eğer isim dizisi boşsa (length === 0), menü boş kalır.
            if (satelliteNames.length === 0) {
                 console.error("HATA: JSON dosyası yüklendi, ancak içi boş veya beklenen formatta değil. Uydu adları bulunamadı.");
                 return; 
            }
            
            allOrbitData = data;
            createSatelliteMenu(satelliteNames);
            
            if (satelliteNames.length > 0) {
                selectSatellite(satelliteNames[0]);
            }
        })
        .catch(error => console.error('Yörünge verisi yüklenirken HATA:', error));
}

        function createSatelliteMenu(satelliteNames) {
            const menu = document.getElementById('satellite-menu');
            menu.innerHTML = '<h3>Uydu Seçim Menüsü</h3>'; 

            satelliteNames.forEach(name => {
                const button = document.createElement('button');
                button.className = 'sat-button';
                button.textContent = name;
                button.onclick = () => selectSatellite(name); 
                menu.appendChild(button);
            });
        }

        function selectSatellite(name) {
            if (!allOrbitData[name] || allOrbitData[name].length === 0) return;

            // 1. Eski yörünge çizgisini sahneden kaldır
            scene.children.filter(obj => obj.name === 'orbit_line').forEach(obj => scene.remove(obj));

            // 2. Yeni yörünge verisini ata ve animasyonu sıfırla
            orbitData = allOrbitData[name];
            currentDataIndex = 0; 

            // 3. Yeni yörünge çizgisini oluştur ve ekle
            drawOrbitPath();

            // 4. Uyduyu yörüngesinin başlangıcına taşı
            const startPos = orbitData[0];
            satellite.position.set(startPos.x, startPos.y, startPos.z);

            console.log(`Uydu değiştirildi: ${name}.`);
        }
        
        function drawOrbitPath() {
            const points = orbitData.map(d => new THREE.Vector3(d.x, d.y, d.z));
            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            
            // Neon yeşili yörünge çizgisi
            const material = new THREE.LineBasicMaterial({ color: 0x00ff00, linewidth: 2 });
            const line = new THREE.Line(geometry, material);
            
            line.name = 'orbit_line'; 
            scene.add(line);
        }

        // --- Animasyon Döngüsü ---

        function animate(currentTime) {
            requestAnimationFrame(animate);

            const deltaTime = (currentTime - lastUpdateTime) / 1000;
            const stepCount = Math.floor(deltaTime * ORBIT_ANIMATION_SPEED * 60);

            if (orbitData.length > 0 && stepCount > 0) {
                lastUpdateTime = currentTime;
                

                currentDataIndex = (currentDataIndex + stepCount) % orbitData.length;
                
                const currentPos = orbitData[currentDataIndex];
                satellite.position.set(currentPos.x, currentPos.y, currentPos.z);
            }
            
            earth.rotation.y += 0.001; 

            controls.update();
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        init();
        animate(performance.now());
    </script>
</body>
</html>